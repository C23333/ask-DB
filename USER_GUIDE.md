# 禅意数据库助手 - 使用指南

> 一个极简的自然语言SQL查询工具

## 🎯 设计理念

禅意数据库助手采用极简设计，专注于一个核心功能：**用自然语言查询数据库**。

- 无需注册登录
- 无复杂功能
- 界面干净纯粹
- 操作简单直观

## 🚀 快速开始

### 第一步：配置后端

1. **打开终端，进入后端目录**
   ```bash
   cd backend
   ```

2. **创建配置文件**
   ```bash
   cp .env.example .env
   ```

3. **编辑配置**
   ```bash
   nano .env
   ```

4. **必需配置（最少）**
   ```env
   ORACLE_USER=your_readonly_user
   ORACLE_PASSWORD=your_password
   ORACLE_HOST=your_database_host
   ORACLE_PORT=1521
   ORACLE_SID=your_sid
   ORACLE_SCHEMA=target_schema_owner   # 可选，如需查询其他Schema
   LLM_API_KEY=your_api_key_here
   ```

5. **启动后端**
   ```bash
   go run cmd/api/main.go
   ```
   *看到"Server listening address=:8080"表示启动成功*

### 第二步：启动前端

1. **打开新终端，进入前端目录**
   ```bash
   cd web
   ```

2. **安装依赖（首次运行）**
   ```bash
   npm install
   ```

3. **启动前端**
   ```bash
   npm run dev
   ```

4. **打开浏览器**
   访问：`http://localhost:5173`

## 📝 使用方法

### 1. 描述你的需求

在首页输入框中，用自然语言描述你的查询需求：

```
例如：
查询最近一周每个产品的销售总额
找出所有活跃用户的基本信息
显示各部门的员工数量
列出库存不足的产品
```

### 2. 生成SQL

点击"开始"按钮，系统会：
- 调用AI理解你的需求
- 生成对应的SQL查询语句
- 显示在界面上

### 3. 执行查询

检查生成的SQL后，点击"执行查询"：
- 系统会安全地执行SQL
- 显示查询结果
- 显示查询行数

### 4. 查看结果

结果以表格形式展示：
- 支持最多50行数据预览
- 可以看到完整的查询结果
- 支持横向滚动查看所有列

## 🔒 安全特性

- **只读权限**：只支持SELECT查询，确保数据安全
- **SQL验证**：自动过滤危险SQL语句
- **权限控制**：使用只读数据库账户
- **执行超时**：防止长时间运行的查询

## 🎨 界面说明

### 首页
- **标题**："问数据库" - 直接明了的用途说明
- **输入框**：描述你的查询需求
- **开始按钮**：开始生成SQL

### 查询页面
- **自然语言描述**：你的原始需求描述
- **生成的SQL**：AI生成的查询语句
- **执行结果**：查询返回的数据表格
- **错误信息**：如果查询失败会显示具体错误

## 💡 使用技巧

### 描述查询的最佳方式

**✅ 好的描述：**
```
查询最近30天销售额最高的10个产品
找出年龄在25-35岁之间的用户信息
显示各部门的平均工资和员工数量
列��库存小于5的商品及其当前库存量
```

**❌ 不太好的描述：**
```
查个东西
给我数据
随便看看
帮我查一下
```

### 支持的查询类型

- **数据统计**：求和、平均值、最大最小值等
- **数据筛选**：按条件筛选数据
- **数据分组**：按字段分组统计
- **排序**：结果排序
- **限制数量**：返回前N条记录

### 常见问题

**Q: 查询结果为空？**
A: 检查你的描述是否准确，或者数据表中确实没有匹配的数据。

**Q: SQL语法错误？**
A: 系统会自动优化SQL，如果持续出错，请简化你的描述。

**Q: 查询速度慢？**
A: 尽量在描述中包含具体的条件限制，避免全表扫描。

## 🛠️ 技术说明

### 系统架构
```
浏览器 → React前端 → Go后端 → LLM → Oracle数据库
```

### 核心技术
- **前端**：React 18 + TypeScript
- **后端**：Go + Gin框架
- **数据库**：Oracle（只读账户）
- **AI服务**：支持OpenAI、Claude等

### 配置说明

#### Oracle数据库配置
```env
ORACLE_USER=readonly_user      # 数据库用户名
ORACLE_PASSWORD=strong_pass    # 数据库密码
ORACLE_HOST=192.168.1.100     # 数据库服务器IP
ORACLE_PORT=1521              # Oracle端口
ORACLE_SID=ORCL               # 数据库SID
ORACLE_SCHEMA=DATA_OWNER      # 可选，指定要读取的Schema
```

#### LLM配置
```env
LLM_PROVIDER=openai          # AI服务提供商
LLM_API_KEY=sk-...           # API密钥
LLM_MODEL=gpt-3.5-turbo      # AI模型
```

## 📋 检查清单

### 环境准备
- [ ] Go 1.21+ 已安装
- [ ] Node.js 18+ 已安装
- [ ] Oracle数据库可访问
- [ ] LLM API密钥已获取

### 配置检查
- [ ] `.env` 文件已创建
- [ ] Oracle连接信息正确
- [ ] LLM API密钥有效
- [ ] 只读数据库账户已创建

### 功能测试
- [ ] 后端服务启动成功（8080端口）
- [ ] 前端页面可访问（5173端口）
- [ ] 能够生成SQL语句
- [ ] 能够成功执行查询
- [ ] 结果显示正确

## 🔧 故障排除

### 常见错误

**1. "Cannot connect to Oracle"**
- 检查Oracle服务器是否可访问
- 验证连接字符串格式：`用户名/密码@主机:端口/SID`
- 确认只读用户权限正确

**2. "LLM API error"**
- 检查API密钥是否正确
- 确认网络连接正常
- 验证API配额是否充足

**3. "Port already in use"**
- 检查8080和5173端口是否被占用
- 关闭其他使用这些端口的程序

**4. 前端无法访问后端**
- 确认后端服务正常运行
- 检查CORS配置
- 验证API路由正确

### 调试方法

1. **查看后端日志**
   ```bash
   go run cmd/api/main.go
   # 在终端中查看实时日志输出
   ```

2. **检查前端控制台**
   - 打开浏览器开发者工具（F12）
   - 查看Console标签页的错误信息
   - 检查Network标签页的API请求

3. **测试数据库连接**
   ```bash
   sqlplus 用户名/密码@连接字符串
   SELECT 1 FROM dual;
   ```

## 📈 性能建议

### 查询优化
- 在描述中尽量包含明确的条件
- 使用字段名而非通配符
- 限制结果集大小

### 系统优化
- 定期分析查询性能
- 监控数据库连接池状态
- 调整LLM超时设置

## 📞 获取帮助

如果遇到问题：

1. **查看本文档**的故障排除部分
2. **检查后端终端**的错误日志
3. **查看浏览器控制台**的错误信息
4. **验证配置文件**是否正确

---

**禅意数据库助手**
简单 · 纯粹 · 专注

让查询数据库变得简单而优雅。
